2023-07-18T16:06:03.764Z
cwd: ~/Docs/Prototypes/warnings-improvement-project
package: govuk-prototype-kit@13.10.1
argv: ~/.nvm/versions/node/v16.15.0/bin/node ~/.npm/_npx/ab0cb2c39bc0319f/node_modules/.bin/govuk-prototype-kit migrate
Started [Check migration is being applied to a pre v13 prototype]
Succeeded [Check migration is being applied to a pre v13 prototype]
2023-07-18T16:06:08.783Z
cwd: ~/Docs/Prototypes/warnings-improvement-project
package: govuk-prototype-kit@13.10.1
argv: ~/.nvm/versions/node/v16.15.0/bin/node ~/Docs/Prototypes/warnings-improvement-project/node_modules/.bin/govuk-prototype-kit migrate -- ~/Docs/Prototypes/warnings-improvement-project
Started [Migrate config.js to config.json]
Started [Update application SCSS file]
Started [Deleted files that are no longer needed]
Started [Deleted directories that are no longer needed]
Started [Delete listen-on-port.js]
Started [Delete server.js]
Started [Delete start.js]
Started [Delete VERSION.txt]
Started [Delete Procfile]
Started [Delete app/assets/sass/application-ie8.scss]
Started [Delete app/assets/sass/unbranded-ie8.scss]
Started [Remove unused directory docs]
Started [Remove unused directory lib]
Started [Remove unused directory update]
Started [Remove unused directory public]
Succeeded [Migrate config.js to config.json]
Succeeded [Delete listen-on-port.js]
Succeeded [Delete server.js]
Succeeded [Delete start.js]
Succeeded [Delete VERSION.txt]
Succeeded [Delete app/assets/sass/application-ie8.scss]
Succeeded [Delete app/assets/sass/unbranded-ie8.scss]
Succeeded [Delete Procfile]
Succeeded [Deleted files that are no longer needed]
Started [Overwrite app/views/layout.html]
Started [Overwrite app/assets/javascripts/application.js]
Found [// Add your routes here - above the module.exports line] in [app/routes.js], replacing
Started [Overwrite app/filters.js]
Found [// Add extra styles here, or re-organise the Sass files in whichever way makes most sense to you] in [app/assets/sass/application.scss], replacing
Failed [Overwrite app/views/layout.html]
Started [Delete app/views/includes/breadcrumb_examples.html]
Started [Delete app/assets/images/unbranded.ico]
Started [Delete app/views/includes/scripts.html]
Started [Delete app/assets/images/separator-2x.png]
Started [Delete app/assets/javascripts/auto-store-data.js]
Started [Delete app/assets/images/separator.png]
Started [Delete app/views/layout_unbranded.html]
Started [Delete app/assets/sass/unbranded.scss]
Started [Delete app/assets/sass/patterns/_mainstream-guide.scss]
Started [Delete app/assets/sass/patterns/_related-items.scss]
Started [Delete app/assets/sass/patterns/_pagination.scss]
Started [Delete app/views/includes/head.html]
Started [Delete app/assets/sass/patterns/_contents-list.scss]
Started [Update app/assets/javascripts/application.js]
Started [Delete app/assets/javascripts/jquery-1.11.3.js]
Started [Delete app/assets/sass/patterns/_step-by-step-header.scss]
Started [Delete app/assets/sass/patterns/_step-by-step-related.scss]
Keeping these lines from old file
Started [Update app/filters.js]
Started [Delete app/assets/sass/patterns/_task-list.scss]
Started [Delete app/assets/sass/patterns/_step-by-step-nav.scss]
Keeping these lines from old file
Failed [Delete app/views/includes/scripts.html]
Failed [Delete app/views/includes/head.html]
Succeeded [Delete app/assets/images/unbranded.ico]
Succeeded [Delete app/views/includes/breadcrumb_examples.html]
Succeeded [Delete app/assets/javascripts/auto-store-data.js]
Succeeded [Delete app/assets/images/separator-2x.png]
Succeeded [Delete app/assets/images/separator.png]
Succeeded [Delete app/views/layout_unbranded.html]
Succeeded [Delete app/assets/sass/patterns/_pagination.scss]
Succeeded [Delete app/assets/sass/patterns/_contents-list.scss]
Succeeded [Delete app/assets/sass/unbranded.scss]
Succeeded [Delete app/assets/javascripts/jquery-1.11.3.js]
Succeeded [Delete app/assets/sass/patterns/_step-by-step-header.scss]
Succeeded [Delete app/assets/sass/patterns/_step-by-step-related.scss]
Succeeded [Delete app/assets/sass/patterns/_step-by-step-nav.scss]
Succeeded [Delete app/assets/sass/patterns/_task-list.scss]
Succeeded [Delete app/assets/sass/patterns/_mainstream-guide.scss]
Succeeded [Update application SCSS file]
Succeeded [Delete app/assets/sass/patterns/_related-items.scss]
Succeeded [Update app/assets/javascripts/application.js]
//,// For guidance on how to create routes see:,// https://prototype-kit.service.gov.uk/docs/create-routes,//,,const govukPrototypeKit = require('govuk-prototype-kit'),const router = govukPrototypeKit.requests.setupRouter(),,// Add your routes here,,,// all routes for registration v2,router.use('/v2', require('./routes_v2')),,router.use('/v4', require('./routes_v4')),,router.use('/v5', require('./routes_v5')),,router.use('/v6', require('./routes_v6')),,router.use('/v7', require('./routes_v7')),,router.use('/v01-1', require('./routes_v01-1')),,router.use('/v01-2', require('./routes_v01-2')),,router.use('/v02-1', require('./routes_v02-1')),,router.use('/v02-2', require('./routes_v02-2')),,,,// Route index page,router.get('/', function (req, res) {,	res.render('index'),}),,router.all('*', (req, res, next) => {,	req.session.data.postcodeNotFound = false,	next(),}),,let addressLookupRouter = require('./routes/address-lookup'),router.use('/address-lookup', addressLookupRouter),,let placeRouter = require('./routes/place'),router.use('/place', placeRouter),,let locationRouter = require('./routes/location'),router.use('/location', locationRouter),,let placeRouter3 = require('./routes_v4/place'),router.use('/place', placeRouter),,let locationRouter3 = require('./routes_v4/location'),router.use('/location', locationRouter),,// CLEAR SESSION ==============================================================,router.get('/cls', function (req, res) {,	req.session.destroy(),	res.render('index'),  }),,// added for filter 2 option,,// Techspike routes START,,const _ = require('underscore'),const { getData } = require('../app/data'),const data = getData(),,function capitalizeFirstLetter(string) {,    return string.charAt(0).toUpperCase() + string.slice(1),  },,router.get('/v02-1/choosewarnings/customise-settings', (req, res) => {,    const sortedData = _.sortBy(data, 'principleTitle'),    const groupedData = _.groupBy(sortedData, 'sectionNumber'),    const allData = _.sortBy(data, 'sectionNumber'),    // console.log(groupedData),    res.render('v02-1/choosewarnings/customise-settings.html', { groupedData, sortedData, allData });,}),,router.get('/v02-1/choosewarnings/locations-no-warnings', (req, res) => {,  const sortedData = _.sortBy(data, 'principleTitle'),  const groupedData = _.groupBy(sortedData, 'sectionNumber'),  const allData = _.sortBy(data, 'sectionNumber'),  // console.log(groupedData),  res.render('v02-1/choosewarnings/locations-no-warnings.html', { groupedData, sortedData, allData });,}),,// Techspike routes END,,,router.post(['/locations-no-warnings/apply-filters', '/customise-settings/apply-filters'], (req, res) => {,  if (req.session.data.clearFilters == "true") {,    req.session.data.section = "",    req.session.data.metres = "",    req.session.data.role = "",    req.session.data.priority = "",    req.session.data.criticalityToBusiness = "",    req.session.data.filteredResults = "",    req.session.data.clearFilters = "",  } else if (req.session.data.continueLocations == "true" && req.originalUrl === '/locations-no-warnings/apply-filters') {,    req.session.data.section = "",    req.session.data.metres = "",    req.session.data.role = "",    req.session.data.priority = "",    req.session.data.criticalityToBusiness = "",    req.session.data.filteredResults = "",    res.redirect('/v02-1/choosewarnings/flood-warnings-success');,  } else if (req.session.data.continueSettings == "true" && req.originalUrl === '/customise-settings/apply-filters') {,    req.session.data.section = "",    req.session.data.metres = "",    req.session.data.role = "",    req.session.data.priority = "",    req.session.data.criticalityToBusiness = "",    req.session.data.filteredResults = "",    res.redirect('/v02-1/choosewarnings/flood-warnings-set');,  } else {,    console.log('success test'),,  const allData = _.sortBy(data, 'sectionNumber'),,//filters,let priorityFilter = req.session.data.priority;,let criticalityToBusinessFilter = req.session.data.criticalityToBusiness;,,//set global scope of filtered results,let filteredResults = [];,,//loop through each of the objects,for (i of allData) {,  // console.log(i.priority);,  //if the object contains a matching value from the filter then add it to the filtered results array,,  if (typeof priorityFilter === 'undefined') {,    priorityFilter= "";,  },  if (i.priority.some((value) => priorityFilter.includes(value))) {,    filteredResults.push(i);,  },,  if (typeof criticalityToBusinessFilter === 'undefined') {,    criticalityToBusinessFilter= "";,  },,  console.log("i.criticalityToBusiness:", i.criticalityToBusiness);,  console.log("criticalityToBusinessFilter:", criticalityToBusinessFilter);,,  if (Array.isArray(i.criticalityToBusiness) && i.criticalityToBusiness.some((value) => criticalityToBusinessFilter.includes(value))) {,    filteredResults.push(i);,  },},,console.log("filteredResults:", filteredResults);,,,,//   let roleFilter = req.session.data.role,//   if (typeof roleFilter === 'undefined') {,//     roleFilter= "",//  },//  if (typeof roleFilter.length) {,//     filteredResults = allData.filter(el => ( roleFilter.indexOf(el.role,el.role1,el.role2,el.role3) >= 0 )),//  },,,,  req.session.data.filteredResults = filteredResults,,},  // get the URL of the page the user came from,  const refererUrl = req.header('Referer');,,,,  // redirect the user back to the page they came from,  res.redirect(refererUrl);,}),,,// set up route variable default status,  router.get('/default', function (req, res) {,	req.session.data = { route: 'default' },	res.redirect(`/v02-1/choosewarnings/overview-flood`),}),,// set up route variable customise status,router.get('/customise', function (req, res) {,	req.session.data = { route: 'customise' },	res.redirect(`/v02-1/choosewarnings/overview-flood`),}),,module.exports = router,
Succeeded [Overwrite app/assets/javascripts/application.js]
Found [module.exports = router;,module.exports = router] in [app/routes.js], removing
Succeeded [Remove unused directory lib]
Succeeded [Remove unused directory public]
Succeeded [Update app/filters.js]
Succeeded [Update routes file]
Succeeded [Overwrite app/filters.js]
Succeeded [Remove unused directory docs]
Succeeded [Remove unused directory update]
Succeeded [Deleted directories that are no longer needed]
Started [Remove old pattern includes from application SCSS file]
Succeeded [Remove old pattern includes from application SCSS file]
Started [Remove empty directory app/assets/sass/patterns]
Started [Remove empty directory app/assets/images]
Started [Remove empty directory app/views/includes]
Skipped deleting app/views/includes
Skipped deleting app/assets/sass/patterns
Skipped deleting app/assets/images
2023-07-18T16:14:16.195Z
cwd: ~/Docs/Prototypes/warnings-improvement-project
package: govuk-prototype-kit@13.10.1
argv: ~/.nvm/versions/node/v16.15.0/bin/node ~/.npm/_npx/ab0cb2c39bc0319f/node_modules/.bin/govuk-prototype-kit migrate
Started [Check migration is being applied to a pre v13 prototype]
Failed [Check migration is being applied to a pre v13 prototype]
2023-07-20T10:47:31.174Z
cwd: ~/Docs/Prototypes/warnings-improvement-project
package: govuk-prototype-kit@13.11.0
argv: ~/.nvm/versions/node/v16.15.0/bin/node ~/.npm/_npx/ab0cb2c39bc0319f/node_modules/.bin/govuk-prototype-kit migrate
Started [Check migration is being applied to a pre v13 prototype]
Failed [Check migration is being applied to a pre v13 prototype]
